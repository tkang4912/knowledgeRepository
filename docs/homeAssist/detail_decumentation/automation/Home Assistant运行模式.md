# 自动化运行模式
 在自动化正在运行时候可能会再次被触发。

而自动化配置中的运行模式控制的就是这种情况下的自动化运行规则。

| （模式）mode   | 说明                                                         |
| ------------ | ------------------------------------------------------------ |
| `single`     | **单次运行（默认）**：如果自动化正在执行，再次触发会被忽略，只发出警告，不会再次运行。 |
| `restart`    | **重启运行**：如果自动化正在执行，新触发会**先中断上一次运行并重新开始**（前提是 conditions 条件仍满足）。 |
| `queued`     | **排队执行**：每次触发都会排入队列，按顺序执行，必须等前一次运行结束才能执行下一次。如果有条件（conditions），则入队时也必须满足条件才生效。 |
| `parallel`   | **并行执行**：每次触发都会开启一个新的自动化执行实例，和前面无关，可同时运行多个。 |

<img src="https://www.home-assistant.io/images/integrations/script/script_modes.jpg" alt="img" style="zoom:150%;" />



对于队列与并行模式，配置中的max选项将控制队列中的可以同时容纳的最大容量和同时执行的最大数量。

其实对应single模式来说，max就是1的队列或并行模式。对于正在执行自动化时候又触发的同一个自动化，将直接舍弃，并发送通知。可以配置选项 max_exceeded 来控制日志的严重性级别。可以把设置max_exceeded为`silent`以忽略警告，也可以将其设置为`log`级别。默认值为警告。

```yml
automation:
  - mode: single
    max_exceeded: silent
    triggers:
      - ...
    actions:
      - ...
      - delay: 300  # 单位秒 (=5 分钟)
```



## 队列示例

有时，自动化在设备上执行的操作不支持同时操作。在这种情况下，可以使用队列。在这种情况下，自动化将在当前调用和队列完成后立即执行。

```
automation:
  - mode: queued
    max: 25
    triggers:
      - ...
    actions:
      - ...
```

